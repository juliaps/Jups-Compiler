/* Jups Operating System */

void main(void){

  int fatstatus;
  int expstatus;
  int fatpc;
  int exppc;
  int fatmemstart;
  int expmemstart;
  int currentprocess;

  /* Define o status inicia de cada processo */
  fatstatus = 0;
  expstatus = 0;

  /* Define a instrucao onde inicia cada processo */
  fatpc = 239;
  exppc = 261;

  /* Define a posicao de memoria de cada processo */
  fatmemstart = 15;
  expmemstart = 53;

  /* Define o primeiro processo */
  currentprocess = 1;

  /* Inicia a execução do primeiro processo */
  setpc(fatpc);

  /* Troca de contexto */

  startcontextswitch();

  /* Salva as informações do processo atual */
  if(currentprocess == 1) {
    fatpc = getpc();
    fatstatus = getprocstatus();
    cpyrbtomem(fatmemstart);
  } else {
    exppc = getpc();
    expstatus = getprocstatus();
    cpyrbtomem(expmemstart);
  }

  /* Selecionar qual processo será executado */
  /* Se o processo ainda não acabou executa o novo processo */
  /* Caso contrario continua executando o anterior*/
  if(currentprocess == 1) {
    if(expstatus == 0) {
      currentprocess = 2;
    }
  } else {
    if(fatstatus == 0) {
      currentprocess = 1;
    }
  }

  /* Carrega as informações do novo processo a ser executado */
  if(currentprocess == 1) {
    if(fatstatus == 0) {
      cpymemtorb(fatmemstart);
      setpc(fatpc);
    }
  } else {
    if(expstatus == 0){
      cpymemtorb(expmemstart);
      setpc(exppc);
    }
  }
}
